![image.png](https://gitee.com/hxc8/images10/raw/master/img/202411291737277.png)
![image.png](https://gitee.com/hxc8/images10/raw/master/img/202411291738974.png)
![image.png](https://gitee.com/hxc8/images10/raw/master/img/202411291739128.png)
![image.png](https://gitee.com/hxc8/images10/raw/master/img/202411291741733.png)
![image.png](https://gitee.com/hxc8/images10/raw/master/img/202411291743145.png)

price (str / Callable): [可选]下单方式, 默认为 "ACTIVE"

- "ACTIVE"：对价下单，在持仓调整过程中，若下单方向为买，对价为卖一价；若下单方向为卖，对价为买一价。
    
- "PASSIVE"：排队价下单，在持仓调整过程中，若下单方向为买，对价为买一价；若下单方向为卖，对价为卖一价，该种方式可能会造成较多撤单.
    
- Callable[[str], Union[float, int]]: 函数参数为下单方向，函数返回值是下单价格。如果返回 nan，程序会抛错。
    

offset_priority (str): [可选]开平仓顺序，昨=平昨仓，今=平今仓，开=开仓，逗号=等待之前操作完成

> 对于下单指令区分平今/昨的交易所(如上期所)，按照今/昨仓的数量计算是否能平今/昨仓 对于下单指令不区分平今/昨的交易所(如中金所)，按照“先平当日新开仓，再平历史仓”的规则计算是否能平今/昨仓，如果这些交易所设置为"昨开"在有当日新开仓和历史仓仓的情况下，会自动跳过平昨仓进入到下一步
> 
> - "今昨,开" 表示先平今仓，再平昨仓，等待平仓完成后开仓，对于没有单向大边的品种避免了开仓保证金不足
>     
> - "今昨开" 表示先平今仓，再平昨仓，并开仓，所有指令同时发出，适合有单向大边的品种
>     
> - "昨开" 表示先平昨仓，再开仓，禁止平今仓，适合股指这样平今手续费较高的品种
>     
> - "开" 表示只开仓，不平仓，适合需要进行锁仓操作的品种



在期货交易中，不同的期货交易所对于平仓的规则有所不同，特别是在平今仓和平昨仓的区分上。

上海期货交易所（上期所）和上海能源交易所是严格区分平今仓和平昨仓的。在平仓时，可以选择平掉当天新开的仓位（平今仓）或者之前交易日开的仓位（平昨仓）。然而，大连商品交易所（大商所）、郑州商品交易所（郑商所）、中国金融期货交易所（中金所）以及上海能源交易中心并没有平今仓的指令。在这些交易所中，如果同时持有老仓和当日新仓，平仓时会默认优先平掉老仓。如果持仓同时为今仓或老仓，则遵循先开先平的原则。

因此，对于没有今昨仓区分的期货交易所，可以概括为大商所、郑商所、中金所以及上期能源中心。在这些交易所进行交易时，投资者需要注意平仓的顺序，因为平仓的指令会按照特定的规则执行。





![image.png](https://gitee.com/hxc8/images10/raw/master/img/202411291744369.png)
mo上面默认参数"今昨,开“，就是先把今仓、昨仓平了，再去开仓。

![image.png](https://gitee.com/hxc8/images10/raw/master/img/202411291751844.png)
