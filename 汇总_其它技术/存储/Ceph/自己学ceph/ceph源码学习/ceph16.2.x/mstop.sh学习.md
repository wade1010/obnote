mstop.sh 是 Ceph 的一个 shell 脚本，主要用于停止 Ceph 集群上的 OSD 和 Monitor 进程，以便进行相关的维护和调试操作。脚本的具体功能如下：

1. 获取当前脚本所在的目录，并设置相关的环境变量。

1. 根据输入的参数，确定要停止的进程的名称、实体和进程 ID。

1. 设置进程相关的目录和 PID 文件路径。

1. 根据实体名称和进程 ID 获取需要停止的 PID 文件路径。

1. 杀掉所有需要停止的进程，如果进程无法停止，则多次尝试，最多尝试 MAX_RETRIES 次；如果仍无法停止，则使用 -9 信号进行强制终止。

需要注意的是，该脚本是在 Ceph 源代码目录下的 src/scripts/ 目录中可以找到，可能在不同版本中存在差异，上述内容可能与实际脚本略有不同。

mstop.sh 脚本的使用方法如下：

1. 在 Ceph 集群的任何节点中下载 

mstop.sh 脚本，并将其加上执行权限。脚本通常在 Ceph 的源代码中 src/scripts/ 目录下可以找到。

1. 执行 

mstop.sh 脚本，指定要停止的进程的名称、实体和进程 ID。例如，如果要停止名为 ceph-osd 的 OSD 进程，可以使用以下命令：

```
./mstop.sh ceph-osd

```

该命令将会停止所有名为 ceph-osd 的 OSD 进程。

如果需要停止某个特定 ID 的 OSD 进程，可以指定实体和进程 ID，例如：

```
./mstop.sh ceph-osd osd 2

```

上述命令将会停止 ID 为 2 的 OSD 进程。

如果需要停止 Monitor 进程，可以指定实体名称 mon，例如：

```
./mstop.sh ceph-mon mon

```

上述命令将会停止所有 Monitor 进程。

1. 该脚本会自动根据进程的名称、实体和进程 ID 来查找该进程的 PID 文件，然后使用 

kill 命令来停止这个进程。如果进程无法停止，则会尝试多次停止，最多尝试 MAX_RETRIES 次（默认为 20），如果仍然无法停止，则会使用强制终止的方式来停止该进程。