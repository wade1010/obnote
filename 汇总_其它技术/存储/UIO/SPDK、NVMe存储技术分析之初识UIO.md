UIO(Userspace I/O)是运行在用户空间的I/O技术。在Linux系统中，一般的设备驱动都是运行在内核空间，而在用户空间使用应用程序调用即可。而UIO则是将设备驱动的很少一部分运行在内核空间，而在用户空间实现驱动的绝大多数功能。那么，在内核空间UIO要做的事情就变得很简单，分为两种：

分配和记录设备需要的资源和注册UIO设备

实现必须在内核空间实现的中断处理函数

为了对UIO有一个直观的认识，先上个图：

![](https://gitee.com/hxc8/images6/raw/master/img/202407190001800.jpg)

UIO 简介

Linux内核提供了一个框架来做用户空间驱动，叫做UIO

该框架是一个字符模式内核驱动程序（在驱动程序/uio 中），它作为一个层在用户空间驱动程序下运行

UIO 有助于卸载一些开发驱动程序的工作

UIO 中的“U”不是通用的

- 由内核框架处理好的设备最好留在内核中（如果您询问许多内核开发人员）

- 网络是半导体供应商进行用户空间 I/O 以提高性能的领域之一

UIO 可以很好地处理简单的设备驱动程序

- 简单的驱动：设备访问和中断处理，无需访问内核框架

内核空间驱动的特点

4.1 Advantages | 优点

以最高权限模式在内核空间中运行，以允许访问中断和硬件资源

有很多内核服务，可以为复杂的设备设计内核空间驱动程序

内核为用户空间提供 API，允许多个应用程序同时访问内核空间驱动程序

- 可以构建更大、更具可扩展性的软件系统

许多驱动程序往往是内核空间

- 在开源社区中提问会更容易

- 将驱动程序推送到开源社区可能更容易

4.2 Disadvantages | 缺点

访问驱动程序的系统调用开销

- 需要从用户空间切换到内核空间（并返回）

- 开销可能是不确定的，会对实时应用程序产生影响

开发人员具有挑战性的学习曲线

- 内核 API 与应用程序级 API 不同，因此需要时间才能变得高效

错误可能是致命的，导致内核崩溃

难以调试

- 内核代码高度优化，有不同的调试工具

频繁的内核 API 更改

- 为一个内核版本构建的内核驱动程序可能无法为另一个版本构建

用户空间驱动的特点

5.1 Advantages | 优点

由于调试工具更容易获得并且对于正常的应用程序开发来说更常见，因此调试的挑战更小

浮点等用户空间服务可用

设备访问非常有效，因为不需要系统调用

Linux的应用API非常稳定

驱动程序可以用任何语言编写，而不仅仅是“C”

5.2 Disadvantages | 缺点

无法访问内核框架和服务

- 连续内存分配、直接缓存控制和 DMA 不可用

- 可能必须复制内核代码或使用内核驱动程序来补充

中断处理不能在用户空间完成

- 它必须由通知用户空间导致一些延迟的内核驱动程序处理

没有预定义的 API 允许应用程序访问设备驱动程序

- 如果多个应用程序访问一个驱动程序，还必须考虑并发性

##  UIO平台服务驱动详解

- 用户只提供一个用户空间驱动

- UIO平台设备驱动从设备树配置并注册一个UIO设备

- 用户空间驱动程序可以直接访问硬件

- 用户空间驱动程序通过读取 UIO 设备文件描述符获得中断通知

![](https://gitee.com/hxc8/images6/raw/master/img/202407190001976.jpg)