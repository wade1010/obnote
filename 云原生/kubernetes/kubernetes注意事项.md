![](https://gitee.com/hxc8/images0/raw/master/img/202407172036252.jpg)

考虑应用程序的高可用性，比如应用程序所在的节点发生了故障，或者需要对节点进行升级和更新维护的时候，应用程序就会停止服务，这样就有可能造成不必要的一些麻烦和损失，解决方案其实也很简单，既然只有一个节点，那就多加几个节点，简单来说就是把所有东西都复制一份，然后放到另外节点上，这样当一个节点发生故障的时候，service会自动将请求转发到另一个节点上来继续提供服务，kubernetes提供一个叫deployment的组件就是来解决这个问题的，它可以定义和管理应用程序的副本数量，以及应用程序的更新策略，可以简化应用程序的部署和更新操作。pod可以理解为在容器上加了一层抽象，这样就可以将一个或多个容器组合在一起，而deployment就可以理解为，在pod的上面再加一层抽象，这样就可以将一个或多个pod组合在一起，并且还具有副本控制，滚动更新，自动扩缩容等高级特性和功能，副本控制就是指可以定义和管理应用程序的副本数量，比如我们可以定义一个应用程序的副本数量为3个，那么如果有副本发生故障的时候，它会自动创建一个新的副本来替代它，始终保持有3个副本在集群中运行，滚动更新就是指定义和管理应用程序的更新策略，可以轻松地升级应用程序的版本，逐渐使用新的版本替换掉旧的版本。确保应用程序的平滑升级

比如数据库的节点发生了故障或者需要升级和更新维护的时候，也会停止服务和影响用户正常使用，所以数据也是需要采用类似多副本的方式来保证高可用性的，但是和应用程序不同的是，我们一般不适用deployment来实现数据库的多副本，因为数据库的多副本之间是有状态的，简单来说就是每个副本都有自己的状态，也就是数据。这些数据都是需要持久化存储的，而且也需要保证，多个副本之间的数据是一致的，这就需要额外的一些机制，比如把数据写到一个共享存储中，或者把数据同步到其它的副本中。对于这些有状态的应用程序，kubernetes提供了另一个叫作statefulset的组件来管理，statefulset和deployment非常类似，也提供了定义和管理应用程序副本数量，或者动态扩缩容等等功能，此外，它还保证每个副本，都有自己稳定的网络标识符和持久化存储，因此，像数据库，缓存，消息队列等等，这些有状态的应用，以及一些保留了会话状态的应用程序，一般都需要statefulset而不是deployment。

**但是statefulset并不是万能的，部署过程还是比较复杂和繁琐的，而且并不是所有的有状态应用，都适合statefulset来部署。**

**一种更加通用和简单的方式是把数据库这种有状态的应用程序，从kubernetes集群中剥离出来，在集群外单独部署，这样可以避免很多不必要的麻烦和问题，而且可以简化集群的架构和管理。**