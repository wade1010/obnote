## 1 Pandas介绍

- 2008年WesMcKinney开发出的库

- 专门用于数据挖掘的开源python库

- 以Numpy为基础，借力Numpy模块在计算方面性能高的优势

- 基于matplotlib，能够简便的画图

- 独特的数据结构

## 2 为什么使用Pandas

- **增强图表可读性**

	- 回忆我们在numpy当中创建学生成绩表样式：

- 返回结果：

```python
  array([[92, 55, 78, 50, 50],
         [71, 76, 50, 48, 96],
         [45, 84, 78, 51, 68],
         [81, 91, 56, 54, 76],
         [86, 66, 77, 67, 95],
         [46, 86, 56, 61, 99],
         [46, 95, 44, 46, 56],
         [80, 50, 45, 65, 57],
         [41, 93, 90, 41, 97],
         [65, 83, 57, 57, 40]])
```

如果数据展示为这样，可读性就会更友好：

![](https://gitee.com/hxc8/images1/raw/master/img/202407172145440.jpg)

#### **便捷的数据处理能力**

![](https://gitee.com/hxc8/images1/raw/master/img/202407172145848.jpg)

- **读取文件方便**

- **封装了Matplotlib、Numpy的画图和计算**

 Pandas中一共有三种数据类型，分别为：Series、DataFrame和MultiIndex（老版本中叫Panel ）。

其中Series是一维数据类型，DataFrame是二维的表格型数据类型，MultiIndex是三维的数据类型。

## 2.DataFrame

DataFrame是一个类似于二维数组或表格(如excel)的对象，既有行索引，又有列索引

- 行索引，表明不同行，横向索引，叫index，0轴，axis=0

- 列索引，表名不同列，纵向索引，叫columns，1轴，axis=1

```python
pd.DataFrame(data=None, index=None, columns=None)
```

参数

- index：行标签。如果没有传入索引参数，则默认会自动创建一个从0-N的整数索引。

- columns：列标签。如果没有传入索引参数，则默认会自动创建一个从0-N的整数索引。

![](https://gitee.com/hxc8/images1/raw/master/img/202407172145920.jpg)

#### 2.3.1 修改行列索引值

```python
stu = ["学生_" + str(i) for i in range(score_df.shape[0])]

# 必须整体全部修改
data.index = stu
```

注意：以下修改方式是错误的

```python
# 错误修改方式
data.index[3] = '学生_3'
```

#### 2.3.2 重设索引

reset_index(drop=False)

- 设置新的下标索引

- drop:默认为False，不删除原来索引，如果为True,删除原来的索引值

```python
# 重置索引,drop=False
data.reset_index()
```

![](https://gitee.com/hxc8/images1/raw/master/img/202407172145890.jpg)

```python
# 重置索引,drop=True
data.reset_index(drop=True)
```

#### 2.3.3 某列值设置为新的索引

set_index(keys, drop=True)

- keys : 列索引名成或者列索引名称的列表

- drop : boolean, default True.当做新的索引，删除原来的列

设置新索引案例

1、创建

```python
df = pd.DataFrame({'month': [1, 4, 7, 10],
                    'year': [2012, 2014, 2013, 2014],
                    'sale':[55, 40, 84, 31]})

   month  sale  year
0  1      55    2012
1  4      40    2014
2  7      84    2013
3  10     31    2014
```

2、以月份设置新的索引

```python
df.set_index('month')
       sale  year
month
1      55    2012
4      40    2014
7      84    2013
10     31    2014
```

3、设置多个索引，以年和月份

```python
df = df.set_index(['year', 'month'])
df
            sale
year  month
2012  1     55
2014  4     40
2013  7     84
2014  10    31
```

> 注：通过刚才的设置，这样DataFrame就变成了一个具有MultiIndex的DataFrame。


![](https://gitee.com/hxc8/images1/raw/master/img/202407172145743.jpg)

# 1 索引操作

Numpy当中我们已经讲过使用索引选取序列和切片选择，pandas也支持类似的操作，也可以直接使用列名、行名

称，甚至组合使用。

### 1.1 **直接使用行列索引**

获取'2018-02-27'这天的'close'的结果

```python
# 直接使用行列索引名字的方式（先列后行）
data['open']['2018-02-27']
23.53

# 不支持的操作
# 错误
data['2018-02-27']['open']
# 错误
data[:1, :2]
```

### 1.2 **结合loc、iloc使用索引**

获取从'2018-02-27':'2018-02-22'，'open'的结果

```python
# 使用loc:只能指定行列索引的名字
data.loc['2018-02-27':'2018-02-22', 'open']

2018-02-27    23.53
2018-02-26    22.80
2018-02-23    22.88
Name: open, dtype: float64

# 使用iloc可以通过索引的下标去获取
# 获取前3天数据,前5列的结果
data.iloc[:3, :5]

            open    high    close    low
2018-02-27    23.53    25.88    24.16    23.53
2018-02-26    22.80    23.78    23.53    22.80
2018-02-23    22.88    23.37    22.82    22.71
```

### 1.3 **使用ix组合索引**

> Warning:Starting in 0.20.0, the .ix indexer is deprecated, in favor of the more strict .iloc and .loc indexers.


获取行第1天到第4天，['open', 'close', 'high', 'low']这个四个指标的结果

```python
# 使用ix进行下表和名称组合做引
data.ix[0:4, ['open', 'close', 'high', 'low']]

# 推荐使用loc和iloc来获取的方式
data.loc[data.index[0:4], ['open', 'close', 'high', 'low']]
data.iloc[0:4, data.columns.get_indexer(['open', 'close', 'high', 'low'])]

            open    close    high    low
2018-02-27    23.53    24.16    25.88    23.53
2018-02-26    22.80    23.53    23.78    22.80
2018-02-23    22.88    22.82    23.37    22.71
2018-02-22    22.25    22.28    22.76    22.02
```

## 3 排序

排序有两种形式，一种对于索引进行排序，一种对于内容进行排序

### 3.1 DataFrame排序

- 使用df.sort_values(by=, ascending=)单个键或者多个键进行排序,

```
参数：
* by：指定排序参考的键
* ascending:默认升序
    * ascending=False:降序
    * ascending=True:升序
```

```python
# 按照开盘价大小进行排序 , 使用ascending指定按照大小排序
data.sort_values(by="open", ascending=True).head()
```

![](https://gitee.com/hxc8/images1/raw/master/img/202407172145752.jpg)

```python
# 按照多个键进行排序
data.sort_values(by=['open', 'high'])
```

![](https://gitee.com/hxc8/images1/raw/master/img/202407172145601.jpg)

- 使用df.sort_index给索引进行排序

这个股票的日期索引原来是从大到小，现在重新排序，从小到大

```python
# 对索引进行排序
data.sort_index()
```

![](https://gitee.com/hxc8/images1/raw/master/img/202407172145768.jpg)

### 3.2 Series排序

- 使用series.sort_values(ascending=True)进行排序

series排序时，只有一列，不需要参数

```python
data['p_change'].sort_values(ascending=True).head()

2015-09-01     -10.03
2015-09-14     -10.02
2016-01-11     -10.02
2015-07-15     -10.02
2015-08-26     -10.01
Name: p_change, dtype: float64
```

- 使用series.sort_index()进行排序

与df一致

```python
# 对索引进行排序
data['p_change'].sort_index().head()

2015-03-02    2.62
2015-03-03    1.44
2015-03-04    1.57
2015-03-05    2.02
2015-03-06    8.51
Name: p_change, dtype: float64
```

## 4 总结

- 1.索引【掌握】

	- 直接索引 -- 先列后行,是需要通过索引的字符串进行获取

	- loc -- 先行后列,是需要通过索引的字符串进行获取

	- iloc -- 先行后列,是通过下标进行索引

	- ix -- 先行后列, 可以用上面两种方法混合进行索引

- 2.赋值【知道】

	- data[""] = **

	- data.** =**

- 3.排序【知道】

	- dataframe

		- 对象.sort_values()

		- 对象.sort_index()

	- series

		- 对象.sort_values()

		- 对象.sort_index()

## 排序

[85]:

data.sort_values(by**=**'open',ascending**=False**).head()

[85]:

|   | open | high | close | low | volume | price_change | p_change | turnover | 
| -- | -- | -- | -- | -- | -- | -- | -- | -- |
| 2015-06-15 | 34.99 | 34.99 | 31.69 | 31.69 | 199369.53 | -3.52 | -10.00 | 6.82 | 
| 2015-06-12 | 34.69 | 35.98 | 35.21 | 34.01 | 159825.88 | 0.82 | 2.38 | 5.47 | 
| 2015-06-10 | 34.10 | 36.35 | 33.85 | 32.23 | 269033.12 | 0.51 | 1.53 | 9.21 | 
| 2017-11-01 | 33.85 | 34.34 | 33.83 | 33.10 | 232325.30 | -0.61 | -1.77 | 5.81 | 
| 2015-06-11 | 33.17 | 34.98 | 34.39 | 32.51 | 173075.73 | 0.54 | 1.59 | 5.92 | 


[87]:

data.sort_values(by**=**['open','high'])

[87]:

|   | open | high | close | low | volume | price_change | p_change | turnover | 
| -- | -- | -- | -- | -- | -- | -- | -- | -- |
| 2015-03-02 | 12.25 | 12.67 | 12.52 | 12.20 | 96291.73 | 0.32 | 2.62 | 3.30 | 
| 2015-09-02 | 12.30 | 14.11 | 12.36 | 12.30 | 70201.74 | -1.10 | -8.17 | 2.40 | 
| 2015-03-03 | 12.52 | 13.06 | 12.70 | 12.52 | 139071.61 | 0.18 | 1.44 | 4.76 | 
| 2015-03-04 | 12.80 | 12.92 | 12.90 | 12.61 | 67075.44 | 0.20 | 1.57 | 2.30 | 
| 2015-03-05 | 12.88 | 13.45 | 13.16 | 12.87 | 93180.39 | 0.26 | 2.02 | 3.19 | 
| ... | ... | ... | ... | ... | ... | ... | ... | ... | 
| 2015-06-11 | 33.17 | 34.98 | 34.39 | 32.51 | 173075.73 | 0.54 | 1.59 | 5.92 | 
| 2017-11-01 | 33.85 | 34.34 | 33.83 | 33.10 | 232325.30 | -0.61 | -1.77 | 5.81 | 
| 2015-06-10 | 34.10 | 36.35 | 33.85 | 32.23 | 269033.12 | 0.51 | 1.53 | 9.21 | 
| 2015-06-12 | 34.69 | 35.98 | 35.21 | 34.01 | 159825.88 | 0.82 | 2.38 | 5.47 | 
| 2015-06-15 | 34.99 | 34.99 | 31.69 | 31.69 | 199369.53 | -3.52 | -10.00 | 6.82 | 


643 rows × 8 columns

[99]:

pd.options.display.max_rows **=** 100

[102]:

data.sort_values(by**=**['open','high']).head(30)

[102]:

|   | open | high | close | low | volume | price_change | p_change | turnover | 
| -- | -- | -- | -- | -- | -- | -- | -- | -- |
| 2015-03-02 | 12.25 | 12.67 | 12.52 | 12.20 | 96291.73 | 0.32 | 2.62 | 3.30 | 
| 2015-09-02 | 12.30 | 14.11 | 12.36 | 12.30 | 70201.74 | -1.10 | -8.17 | 2.40 | 
| 2015-03-03 | 12.52 | 13.06 | 12.70 | 12.52 | 139071.61 | 0.18 | 1.44 | 4.76 | 
| 2015-03-04 | 12.80 | 12.92 | 12.90 | 12.61 | 67075.44 | 0.20 | 1.57 | 2.30 | 
| 2015-03-05 | 12.88 | 13.45 | 13.16 | 12.87 | 93180.39 | 0.26 | 2.02 | 3.19 | 
| 2015-09-08 | 12.89 | 13.98 | 13.85 | 12.67 | 60627.79 | 1.09 | 8.54 | 2.08 | 
| 2015-09-07 | 12.92 | 13.38 | 12.77 | 12.63 | 52490.04 | 0.37 | 2.98 | 1.80 | 
| 2015-03-06 | 13.17 | 14.48 | 14.28 | 13.13 | 179831.72 | 1.12 | 8.51 | 6.16 | 
| 2015-09-16 | 13.43 | 14.65 | 14.64 | 13.40 | 79799.99 | 1.32 | 9.91 | 2.73 | 
| 2016-01-29 | 13.59 | 14.21 | 13.97 | 13.30 | 38279.97 | 0.40 | 2.95 | 1.31 | 
| 2015-09-15 | 13.74 | 14.25 | 13.34 | 13.10 | 80589.21 | -1.12 | -7.75 | 2.76 | 
| 2015-09-21 | 13.90 | 14.57 | 14.55 | 13.73 | 60466.03 | 0.54 | 3.85 | 2.07 | 
| 2015-09-09 | 13.95 | 14.88 | 14.63 | 13.95 | 95082.47 | 0.77 | 5.56 | 3.25 | 
| 2016-01-28 | 13.96 | 14.21 | 13.56 | 13.40 | 27015.35 | -0.45 | -3.21 | 0.92 | 
| 2016-02-01 | 13.99 | 14.28 | 14.10 | 13.90 | 27130.60 | 0.12 | 0.86 | 0.93 | 
| 2015-09-10 | 14.00 | 15.28 | 14.62 | 13.80 | 81936.15 | -0.02 | -0.14 | 2.80 | 
| 2016-03-01 | 14.02 | 14.60 | 14.40 | 14.02 | 29640.23 | 0.38 | 2.71 | 1.01 | 
| 2015-09-18 | 14.10 | 14.40 | 14.02 | 13.51 | 59277.66 | 0.04 | 0.29 | 2.03 | 
| 2015-03-12 | 14.11 | 14.80 | 14.11 | 13.95 | 84978.37 | -0.19 | -1.33 | 2.91 | 
| 2015-03-13 | 14.13 | 14.50 | 14.47 | 14.08 | 61342.22 | 0.36 | 2.55 | 2.10 | 
| 2015-03-09 | 14.14 | 14.85 | 14.31 | 13.80 | 144945.66 | 0.03 | 0.21 | 4.96 | 
| 2016-02-02 | 14.15 | 14.71 | 14.55 | 14.05 | 42175.52 | 0.46 | 3.27 | 1.44 | 
| 2015-03-10 | 14.20 | 14.80 | 14.65 | 14.01 | 101213.51 | 0.34 | 2.38 | 3.46 | 
| 2016-03-02 | 14.40 | 15.20 | 15.18 | 14.36 | 49128.62 | 0.77 | 5.34 | 1.68 | 
| 2016-02-03 | 14.50 | 14.53 | 14.47 | 14.25 | 22184.43 | -0.07 | -0.48 | 0.76 | 
| 2015-03-16 | 14.52 | 15.05 | 14.87 | 14.51 | 94468.30 | 0.40 | 2.76 | 3.23 | 
| 2016-02-04 | 14.52 | 15.25 | 15.15 | 14.52 | 40090.40 | 0.67 | 4.63 | 1.37 | 
| 2015-09-22 | 14.53 | 15.19 | 14.97 | 14.48 | 81399.43 | 0.44 | 3.03 | 2.79 | 
| 2015-09-17 | 14.58 | 15.35 | 13.95 | 13.92 | 88783.16 | -0.70 | -4.78 | 3.04 | 
| 2016-01-27 | 14.64 | 14.69 | 13.99 | 13.26 | 40538.52 | -0.51 | -3.52 | 1.39 | 


[104]:

data.open.head()

[104]:

```
2018-02-27    23.53
2018-02-26    22.80
2018-02-23    22.88
2018-02-22    22.25
2018-02-14    21.49
Name: open, dtype: float64
```

[110]:

data['open'].add(1).head()  *# 可以用data.open*

[110]:

```
2018-02-27    24.53
2018-02-26    23.80
2018-02-23    23.88
2018-02-22    23.25
2018-02-14    22.49
Name: open, dtype: float64
```

[111]:

Selection deleted

data['open']**>**23  *# 不能用data.open*

[111]:

```
2018-02-27     True
2018-02-26    False
2018-02-23    False
2018-02-22    False
2018-02-14    False
              ...  
2015-03-06    False
2015-03-05    False
2015-03-04    False
2015-03-03    False
2015-03-02    False
Name: open, Length: 643, dtype: bool
```

[112]:

data[data['open']**>**23].head()

[112]:

|   | open | high | close | low | volume | price_change | p_change | turnover | 
| -- | -- | -- | -- | -- | -- | -- | -- | -- |
| 2018-02-27 | 23.53 | 25.88 | 24.16 | 23.53 | 95578.03 | 0.63 | 2.68 | 2.39 | 
| 2018-02-01 | 23.71 | 23.86 | 22.42 | 22.22 | 66414.64 | -1.30 | -5.48 | 1.66 | 
| 2018-01-31 | 23.85 | 23.98 | 23.72 | 23.31 | 49155.02 | -0.11 | -0.46 | 1.23 | 
| 2018-01-30 | 23.71 | 24.08 | 23.83 | 23.70 | 32420.43 | 0.05 | 0.21 | 0.81 | 
| 2018-01-29 | 24.40 | 24.63 | 23.77 | 23.72 | 65469.81 | -0.73 | -2.98 | 1.64 | 


[121]:

data[data['open']**>**23 **&** (data['open']**<**24)]  *#得有括号*

[121]:

|   | open | high | close | low | volume | price_change | p_change | turnover | 
| -- | -- | -- | -- | -- | -- | -- | -- | -- |
| 2018-02-27 | 23.53 | 25.88 | 24.16 | 23.53 | 95578.03 | 0.63 | 2.68 | 2.39 | 
| 2018-02-26 | 22.80 | 23.78 | 23.53 | 22.80 | 60985.11 | 0.69 | 3.02 | 1.53 | 
| 2018-02-23 | 22.88 | 23.37 | 22.82 | 22.71 | 52914.01 | 0.54 | 2.42 | 1.32 | 
| 2018-02-22 | 22.25 | 22.76 | 22.28 | 22.02 | 36105.01 | 0.36 | 1.64 | 0.90 | 
| 2018-02-14 | 21.49 | 21.99 | 21.92 | 21.48 | 23331.04 | 0.44 | 2.05 | 0.58 | 
| ... | ... | ... | ... | ... | ... | ... | ... | ... | 
| 2015-03-06 | 13.17 | 14.48 | 14.28 | 13.13 | 179831.72 | 1.12 | 8.51 | 6.16 | 
| 2015-03-05 | 12.88 | 13.45 | 13.16 | 12.87 | 93180.39 | 0.26 | 2.02 | 3.19 | 
| 2015-03-04 | 12.80 | 12.92 | 12.90 | 12.61 | 67075.44 | 0.20 | 1.57 | 2.30 | 
| 2015-03-03 | 12.52 | 13.06 | 12.70 | 12.52 | 139071.61 | 0.18 | 1.44 | 4.76 | 
| 2015-03-02 | 12.25 | 12.67 | 12.52 | 12.20 | 96291.73 | 0.32 | 2.62 | 3.30 | 


643 rows × 8 columns

[123]:

*# 通过query使得刚才的过程更加方便简单*

data.query('open<24 & open>23').head()

[123]:

|   | open | high | close | low | volume | price_change | p_change | turnover | 
| -- | -- | -- | -- | -- | -- | -- | -- | -- |
| 2018-02-27 | 23.53 | 25.88 | 24.16 | 23.53 | 95578.03 | 0.63 | 2.68 | 2.39 | 
| 2018-02-01 | 23.71 | 23.86 | 22.42 | 22.22 | 66414.64 | -1.30 | -5.48 | 1.66 | 
| 2018-01-31 | 23.85 | 23.98 | 23.72 | 23.31 | 49155.02 | -0.11 | -0.46 | 1.23 | 
| 2018-01-30 | 23.71 | 24.08 | 23.83 | 23.70 | 32420.43 | 0.05 | 0.21 | 0.81 | 
| 2018-01-16 | 23.40 | 24.60 | 24.40 | 23.30 | 101295.42 | 0.96 | 4.10 | 2.54 | 


[124]:

data[data['open'].isin([23.53,23.85])]

[124]:

|   | open | high | close | low | volume | price_change | p_change | turnover | 
| -- | -- | -- | -- | -- | -- | -- | -- | -- |
| 2018-02-27 | 23.53 | 25.88 | 24.16 | 23.53 | 95578.03 | 0.63 | 2.68 | 2.39 | 
| 2018-01-31 | 23.85 | 23.98 | 23.72 | 23.31 | 49155.02 | -0.11 | -0.46 | 1.23 | 
| 2017-07-26 | 23.53 | 23.92 | 23.40 | 22.85 | 110276.48 | -0.30 | -1.27 | 2.76 | 
| 2015-12-18 | 23.53 | 24.66 | 23.99 | 23.43 | 109230.05 | 0.65 | 2.79 | 3.74 | 
| 2015-11-26 | 23.85 | 24.08 | 23.53 | 23.50 | 51446.29 | -0.31 | -1.30 | 1.76 | 


## 文件读取与存储

![](https://gitee.com/hxc8/images1/raw/master/img/202407172145640.jpg)