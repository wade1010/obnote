![](https://gitee.com/hxc8/images8/raw/master/img/202407191118257.jpg)

所谓打开是把哪些硬盘里面存的那个关于文件的文件控制块的内容给读到内存中来，把相关的关键信息放到打开文件表里面，返回这个项的索引index给应用程序，

![](https://gitee.com/hxc8/images8/raw/master/img/202407191118188.jpg)

当一个进程做了一个打开文件操作之后，它会返回一个index,这个index指出这个进程的打开文件表的位置，把这个项取出来之后，再基于这个项找到系统层面打开的文件表，有可能是不同进程打开了同一个文件，在系统打开文件表里面只记录一项就可以了，那基于这一项进一步找到，它是一个目录或者是文件，会有不同的处理，这里以文件为例，就可以知道这个文件的node信息，文件的节点信息里面会包含到底这个文件它的数据在什么地方。做read write操作的时候，你会有一个offset，来指出你想操作这个文件的哪一个位置起的哪个数据，这个所谓的offset会经过这个文件控制块里面的一些转换，这个offset转换成一个disk的一个扇区的编号。

你要访问这块数据，其实要访问对应的一系列的扇区，然后文件系统就把这些扇区内容读/写，读的话，就是读到内存buffer中来。这样就可以把这个你需要的数据再从这个读到内存buffer里面取出这个应用程序说需要的数据，传回给应用程序。

锁的保护机制：

![](https://gitee.com/hxc8/images8/raw/master/img/202407191118728.jpg)