  

![](https://gitee.com/hxc8/images8/raw/master/img/202407191126169.jpg)

上下文切换：

当我们运行不同程序的时候，可以知道，程序以进程的方式在操作系统运行。各个进程之间是共享这个CPU资源的，在不同时候，进程需要切换，让不同的进程可以占CPU执行，这个过程就是进程上下文切换。

进程上下文切换，切换的是什么东西？

切换进程所用到的寄存器，寄存器是和CPU紧密相连的，意味着在操作系统里面实现进程切换的话，要关注操作系统所载的CPU，它到底具有哪些寄存器，以及这些寄存器哪些是被进程所使用的。

进城运行时需要哪些寄存器呢？

程序寄存器，它指出了进程执行到什么地方

栈指针也是寄存器，可以知道调用关系以及相应的变量位于什么位置。

这些信息在做进程切换的时候，需要把这些信息保存到进程控制块中的某个位置，保存之后呢，当运行另外一个进程的时候，需要把这个寄存器从那个进程控制块中取出来，甚至context这么上下问取出来，然后恢复到CPU里面去，相当于把寄存器的资源重新赋好，这使得我们接下来这个进程可以继续在CPU上执行，

上述就是大致的上下文切换。

![](https://gitee.com/hxc8/images8/raw/master/img/202407191126666.jpg)

需要注意一点，这里面所有这些信息都是和我们硬件紧密相连的，所以在实际操作系统中这部分代码基本上都是用汇编代码来写的。

![](https://gitee.com/hxc8/images8/raw/master/img/202407191126454.jpg)

后面少了一节课7-12